services:
  model-sync:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: model-sync
    restart: unless-stopped

    # Host port -> container port
    ports:
      - "${MODEL_SYNC_PORT:-9090}:9090"

    # Persist config and mount models + ssh keys
    volumes:
      - ${MODEL_SYNC_MODELS_DIR:-./models}:/models
      - model_sync_config:/config
      - ${MODEL_SYNC_SSH_DIR:-~/.ssh}:/ssh:ro

    environment:
      # Ensure ~/.model_sync_config.json persists
      - HOME=/config
      - TZ=${TZ:-America/Chicago}

    # Explicit run command so poll interval is configurable
    command: >
      python sync-models.py
      --host 0.0.0.0
      --port 9090
      --peer-poll-seconds ${MODEL_SYNC_PEER_POLL_SECONDS:-10}

volumes:
  model_sync_config:
